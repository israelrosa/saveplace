{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport { StatusBar } from 'expo-status-bar';\nimport React, { useRef, useState, useEffect, useCallback } from 'react';\nimport { useTheme } from 'styled-components';\nimport UilAngleLeft from '@iconscout/react-native-unicons/icons/uil-angle-left-b';\nimport UilTrash from '@iconscout/react-native-unicons/icons/uil-trash';\nimport { useNavigation, useRoute } from '@react-navigation/native';\nimport Input from \"../../components/Input\";\nimport { Form } from '@unform/mobile';\nimport { Switch } from 'react-native-paper';\nimport Option from \"../../components/Option\";\nimport CustomButton from \"../../components/CustomButton\";\nimport SelectInput from \"../../components/SelectInput\";\nimport * as Yup from 'yup';\nimport { useAppDispatch, useAppSelector } from \"../../hooks/storeHook\";\nimport { createQueue, deleteQueue, updateQueue } from \"../../store/actions/queueActions\";\nimport Modal from \"../../components/Modal\";\nimport { getTags } from \"../../store/actions/tagActions\";\nimport { ActionsContainer, Container, Content, Header, HeaderAction, HeaderText, ModalContainer, Section } from \"./styles\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\n\nvar QueueForm = function QueueForm() {\n  var _route$params3, _route$params4, _route$params5;\n\n  var theme = useTheme();\n  var formRef = useRef(null);\n  var navigation = useNavigation();\n\n  var _useAppSelector = useAppSelector(function (state) {\n    return state;\n  }),\n      tag = _useAppSelector.tag,\n      queue = _useAppSelector.queue;\n\n  var dispatch = useAppDispatch();\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      status = _useState2[0],\n      setStatus = _useState2[1];\n\n  var _useState3 = useState({}),\n      _useState4 = _slicedToArray(_useState3, 2),\n      selectedTag = _useState4[0],\n      setSelectedTag = _useState4[1];\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      isLoading = _useState6[0],\n      setIsLoading = _useState6[1];\n\n  var _useState7 = useState(''),\n      _useState8 = _slicedToArray(_useState7, 2),\n      queueName = _useState8[0],\n      setQueueName = _useState8[1];\n\n  var _useState9 = useState(false),\n      _useState10 = _slicedToArray(_useState9, 2),\n      openModal = _useState10[0],\n      setOpenModal = _useState10[1];\n\n  var _useState11 = useState(''),\n      _useState12 = _slicedToArray(_useState11, 2),\n      queueId = _useState12[0],\n      setQueueId = _useState12[1];\n\n  var route = useRoute();\n  useEffect(function () {\n    var _route$params;\n\n    dispatch(getTags());\n\n    if (route != null && (_route$params = route.params) != null && _route$params.isEditMode) {\n      var _tag$data;\n\n      setQueueId(queue.queueDetail.id);\n      setStatus(queue.queueDetail.status === 'active');\n      var queueTag = tag == null ? void 0 : (_tag$data = tag.data) == null ? void 0 : _tag$data.find(function (t) {\n        return t.id === queue.queueDetail.tagId;\n      });\n\n      if (queueTag) {\n        setSelectedTag(queueTag);\n      }\n\n      setQueueName(queue.queueDetail.name);\n    }\n  }, [route.params, queue.queueDetail]);\n  var handleSubmit = useCallback(function (data) {\n    (function _callee() {\n      var _route$params2, schema, validationErrors;\n\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              formRef.current.setErrors({});\n              schema = Yup.object().shape({\n                queueName: Yup.string().required('O nome da fila é obrigatório')\n              });\n              _context.next = 5;\n              return _regeneratorRuntime.awrap(schema.validate(data, {\n                abortEarly: false\n              }));\n\n            case 5:\n              setIsLoading(true);\n\n              if (route != null && (_route$params2 = route.params) != null && _route$params2.isEditMode) {\n                dispatch(updateQueue({\n                  queueId: queueId,\n                  name: data.queueName,\n                  tagId: selectedTag.id,\n                  status: status ? 'active' : 'disabled'\n                })).then(function () {\n                  navigation.navigate('EstablishmentQueueDetails', {\n                    id: queueId\n                  });\n                  setIsLoading(false);\n                }).catch(function (err) {\n                  console.log(err);\n                });\n              } else {\n                dispatch(createQueue({\n                  name: data.queueName,\n                  tagId: selectedTag.id,\n                  status: status ? 'active' : 'disabled'\n                })).then(function (id) {\n                  navigation.navigate('EstablishmentQueueDetails', {\n                    id: id\n                  });\n                  setIsLoading(false);\n                }).catch(function (err) {\n                  console.log(err);\n                });\n              }\n\n              _context.next = 13;\n              break;\n\n            case 9:\n              _context.prev = 9;\n              _context.t0 = _context[\"catch\"](0);\n              validationErrors = {};\n\n              if (_context.t0 instanceof Yup.ValidationError) {\n                _context.t0.inner.forEach(function (error) {\n                  Reflect.set(validationErrors, error.path, error.message);\n                });\n\n                formRef.current.setErrors(validationErrors);\n              }\n\n            case 13:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, [[0, 9]], Promise);\n    })();\n  }, [route.params, queueId, selectedTag]);\n\n  var handleDeleteQueue = function handleDeleteQueue() {\n    dispatch(deleteQueue(queueId));\n    navigation.navigate('Queues');\n  };\n\n  var handleSelectTags = function handleSelectTags() {\n    setOpenModal(true);\n  };\n\n  var handleSelectTag = function handleSelectTag(item) {\n    setSelectedTag(item);\n    setOpenModal(false);\n  };\n\n  return _jsxs(Container, {\n    children: [_jsx(StatusBar, {\n      backgroundColor: theme.colors.primary,\n      style: \"light\"\n    }), _jsxs(Header, {\n      children: [_jsxs(HeaderAction, {\n        onPress: function onPress() {\n          return navigation.navigate('Queues');\n        },\n        children: [_jsx(UilAngleLeft, {\n          color: theme.colors.text.reverse,\n          size: 24\n        }), _jsx(HeaderText, {\n          children: route != null && (_route$params3 = route.params) != null && _route$params3.isEditMode ? 'Editar fila' : 'Criar fila'\n        })]\n      }), (route == null ? void 0 : (_route$params4 = route.params) == null ? void 0 : _route$params4.isEditMode) && _jsx(HeaderAction, {\n        onPress: handleDeleteQueue,\n        children: _jsx(UilTrash, {\n          color: theme.colors.text.reverse,\n          size: 24\n        })\n      })]\n    }), _jsx(Content, {\n      children: _jsxs(Form, {\n        initialData: {\n          queueName: queueName\n        },\n        ref: formRef,\n        onSubmit: handleSubmit,\n        children: [_jsx(Section, {\n          children: \"Detalhes\"\n        }), _jsx(Input, {\n          value: queueName,\n          label: \"Nome da fila\",\n          name: \"queueName\",\n          onChangeText: function onChangeText(text) {\n            return setQueueName(text);\n          }\n        }), _jsx(Section, {\n          style: {\n            marginTop: 24\n          },\n          children: \"Tag\"\n        }), _jsx(SelectInput, {\n          value: (selectedTag == null ? void 0 : selectedTag.name) || '',\n          placeholder: \"Selecione a tag\",\n          onPress: handleSelectTags\n        }), _jsx(Section, {\n          style: {\n            marginTop: 24\n          },\n          children: \"Status\"\n        }), _jsx(Option, {\n          hideArrowRight: true,\n          text: status ? 'Aberto' : 'Fechado',\n          iconRight: _jsx(Switch, {\n            value: status,\n            onValueChange: function onValueChange(value) {\n              return setStatus(value);\n            }\n          })\n        })]\n      })\n    }), _jsx(ActionsContainer, {\n      children: _jsx(CustomButton, {\n        color: theme.colors.primary,\n        text: route != null && (_route$params5 = route.params) != null && _route$params5.isEditMode ? 'Enviar' : 'Criar',\n        isLoading: isLoading,\n        onPress: function onPress() {\n          return formRef.current.submitForm();\n        }\n      })\n    }), openModal && _jsx(ModalContainer, {\n      children: _jsx(Modal, {\n        onSelect: handleSelectTag,\n        items: tag.data,\n        title: \"Tags\",\n        onClose: function onClose() {\n          return setOpenModal(false);\n        }\n      })\n    })]\n  });\n};\n\nexport default QueueForm;","map":{"version":3,"sources":["/home/israel/Projects/saveplace/app/src/screens/QueueForm/index.tsx"],"names":["StatusBar","React","useRef","useState","useEffect","useCallback","useTheme","UilAngleLeft","UilTrash","useNavigation","useRoute","Input","Form","Switch","Option","CustomButton","SelectInput","Yup","useAppDispatch","useAppSelector","createQueue","deleteQueue","updateQueue","Modal","getTags","ActionsContainer","Container","Content","Header","HeaderAction","HeaderText","ModalContainer","Section","QueueForm","theme","formRef","navigation","state","tag","queue","dispatch","status","setStatus","selectedTag","setSelectedTag","isLoading","setIsLoading","queueName","setQueueName","openModal","setOpenModal","queueId","setQueueId","route","params","isEditMode","queueDetail","id","queueTag","data","find","t","tagId","name","handleSubmit","current","setErrors","schema","object","shape","string","required","validate","abortEarly","then","navigate","catch","err","console","log","validationErrors","ValidationError","inner","forEach","error","Reflect","set","path","message","handleDeleteQueue","handleSelectTags","handleSelectTag","item","colors","primary","text","reverse","marginTop","value","submitForm"],"mappings":"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","sourcesContent":["import { StatusBar } from 'expo-status-bar';\nimport React, { useRef, useState, useEffect, useCallback } from 'react';\nimport { useTheme } from 'styled-components';\nimport UilAngleLeft from '@iconscout/react-native-unicons/icons/uil-angle-left-b';\nimport UilTrash from '@iconscout/react-native-unicons/icons/uil-trash';\nimport { useNavigation, useRoute } from '@react-navigation/native';\nimport Input from 'components/Input';\nimport { Form } from '@unform/mobile';\nimport { Switch } from 'react-native-paper';\nimport Option from 'components/Option';\nimport CustomButton from 'components/CustomButton';\nimport SelectInput from 'components/SelectInput';\nimport * as Yup from 'yup';\nimport { useAppDispatch, useAppSelector } from 'hooks/storeHook';\nimport { createQueue, deleteQueue, updateQueue } from 'store/actions/queueActions';\nimport Modal from 'components/Modal';\nimport { getTags } from 'store/actions/tagActions';\nimport {\n  ActionsContainer,\n  Container,\n  Content,\n  Header,\n  HeaderAction,\n  HeaderText,\n  ModalContainer,\n  Section,\n} from './styles';\n\nconst QueueForm: React.FC = () => {\n  const theme = useTheme();\n  const formRef = useRef(null);\n  const navigation = useNavigation();\n  const { tag, queue } = useAppSelector(state => state);\n  const dispatch = useAppDispatch();\n  const [status, setStatus] = useState(false);\n  const [selectedTag, setSelectedTag] = useState({});\n  const [isLoading, setIsLoading] = useState(false);\n  const [queueName, setQueueName] = useState('');\n  const [openModal, setOpenModal] = useState(false);\n  const [queueId, setQueueId] = useState('');\n  const route = useRoute();\n\n  useEffect(() => {\n    dispatch(getTags());\n    if (route?.params?.isEditMode) {\n      setQueueId(queue.queueDetail.id);\n      setStatus(queue.queueDetail.status === 'active');\n      const queueTag = tag?.data?.find(t => t.id === queue.queueDetail.tagId);\n      if (queueTag) {\n        setSelectedTag(queueTag);\n      }\n      setQueueName(queue.queueDetail.name);\n    }\n  }, [route.params, queue.queueDetail]);\n\n  const handleSubmit = useCallback((data) => {\n    (async () => {\n      try {\n        // Remove all previous errors\n        formRef.current.setErrors({});\n        const schema = Yup.object().shape({\n          queueName: Yup.string().required('O nome da fila é obrigatório'),\n        });\n        await schema.validate(data, {\n          abortEarly: false,\n        });\n\n        // Validation passed\n        setIsLoading(true);\n        if (route?.params?.isEditMode) {\n          dispatch(updateQueue({\n            queueId,\n            name: data.queueName,\n            tagId: selectedTag.id,\n            status: status ? 'active' : 'disabled'\n          })).then(() => {\n            navigation.navigate('EstablishmentQueueDetails', { id: queueId });\n            setIsLoading(false);\n          }).catch((err) => {\n            console.log(err);\n          });\n        } else {\n          dispatch(createQueue({\n            name: data.queueName,\n            tagId: selectedTag.id,\n            status: status ? 'active' : 'disabled'\n          })).then((id) => {\n            navigation.navigate('EstablishmentQueueDetails', { id });\n            setIsLoading(false);\n          }).catch((err) => {\n            console.log(err);\n          });\n        }\n      } catch (err) {\n        const validationErrors = {};\n        if (err instanceof Yup.ValidationError) {\n          err.inner.forEach((error) => {\n            Reflect.set(validationErrors, error.path, error.message);\n          });\n          formRef.current.setErrors(validationErrors);\n        }\n      }\n    })();\n  }, [route.params, queueId, selectedTag]);\n\n  const handleDeleteQueue = () => {\n    dispatch(deleteQueue(queueId));\n    navigation.navigate('Queues');\n  };\n\n  const handleSelectTags = () => {\n    setOpenModal(true);\n  };\n\n  const handleSelectTag = (item) => {\n    setSelectedTag(item);\n    setOpenModal(false);\n  };\n\n  return (\n    <Container>\n      <StatusBar backgroundColor={theme.colors.primary} style=\"light\" />\n      <Header>\n        <HeaderAction onPress={() => navigation.navigate('Queues')}>\n          <UilAngleLeft color={theme.colors.text.reverse} size={24} />\n          <HeaderText>{route?.params?.isEditMode ? 'Editar fila' : 'Criar fila'}</HeaderText>\n        </HeaderAction>\n        {route?.params?.isEditMode && (\n          <HeaderAction onPress={handleDeleteQueue}>\n            <UilTrash color={theme.colors.text.reverse} size={24} />\n          </HeaderAction>\n        )}\n      </Header>\n      <Content>\n        <Form initialData={{ queueName }} ref={formRef} onSubmit={handleSubmit}>\n          <Section>Detalhes</Section>\n          <Input value={queueName} label=\"Nome da fila\" name=\"queueName\" onChangeText={text => setQueueName(text)} />\n          <Section style={{ marginTop: 24 }}>Tag</Section>\n          <SelectInput value={selectedTag?.name || ''} placeholder=\"Selecione a tag\" onPress={handleSelectTags} />\n          <Section style={{ marginTop: 24 }}>Status</Section>\n          <Option hideArrowRight text={status ? 'Aberto' : 'Fechado'} iconRight={<Switch value={status} onValueChange={(value) => setStatus(value)} />} />\n        </Form>\n      </Content>\n      <ActionsContainer>\n        <CustomButton\n          color={theme.colors.primary}\n          text={route?.params?.isEditMode ? 'Enviar' : 'Criar'}\n          isLoading={isLoading}\n          onPress={() => formRef.current.submitForm()}\n        />\n      </ActionsContainer>\n      {openModal && (\n        <ModalContainer>\n          <Modal onSelect={handleSelectTag} items={tag.data} title=\"Tags\" onClose={() => setOpenModal(false)} />\n        </ModalContainer>\n      )}\n    </Container>\n  );\n};\n\nexport default QueueForm;\n"]},"metadata":{},"sourceType":"module"}